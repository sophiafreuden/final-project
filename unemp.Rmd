---
title: "unemp"
author: "Sophia Freuden"
date: "11/21/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(fs)
library(readxl)
library(tidyverse)
```

### R Markdown for Unemployment Plots and Regressions with Crime Rates

<br>

#### These plots are rendered as images and saved to a directory within my app that then renders them in Shiny.  

<br>

*Please see the readme file for specific instructions on how to run these codes chunks (i.e. what order to run them in).*  

```{r reading in unemployment data}
# I do more or less the same thing across multiple Rmd files,
# but I call the data something different every time. I'm not
# entirely should how the environment in R Studio works for
# saved objects. I don't know if you save data as an object
# in R for use in one Rmd that you will be able to call the
# same object in another Rmd (I'm pretty sure you can't).
# I always read them into new objects and name them something
# different.

unemp <- read_xlsx(path = "cleaned-data/BLS PDX Unemployment.xlsx")
```

```{r adding yearly average unemployment rate column}
# I originally added this in Excel by hand, but I decided that
# mutating a new column in R would be both cooler and perhaps
# more ethical... plus it spares me from having to explain
# what I did in the readme.

unemp$Avg <- rowMeans(unemp[, 2:13], na.rm = TRUE)

# This took me a little bit to figure out. Averaging across
# rows does not work like using mean() in mutate, because
# that applies a function down a column. Knowing a bit of
# base R is helpful at times! I had to include na.rm =
# TRUE because I don't have data points for 3 months in
# 2019.

# With digits = 1 below, I rounded this average to match
# the rounding of the original data.

unemp <- unemp %>% mutate(Avg = round(Avg, digits = 1))
```

```{r plotting yearly average unemployment rate over time}
unempplot <- ggplot(unemp, aes(x = Year, y = Avg)) +
  geom_line() +
  labs(
    title = "Unemployment Rate of Portland Metropolitan Area Over Time",
    subtitle = "Post-Recession Era Sees Plummet in Unemployment Rate",
    caption = "Thanks, Obama."
  ) +
  theme_minimal() +
  scale_x_continuous(breaks = c(2010, 2012, 2014, 2016, 2018)) +
  ylab("Yearly Average Unemployment Rate")

# Forgive my political posturing, I couldn't help it.
```

```{r saving unemployment plot as an image, include=FALSE}
png("unempplot.png", width = 576, height = 576, res = 120)
unempplot
dev.off()

file_copy(
  path = "unempplot.png",
  new_path = "pdx-probs/www/unempplot.png",
  overwrite = TRUE
)

file_delete(path = "unempplot.png")
```

